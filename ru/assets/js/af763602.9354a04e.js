"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1260],{3905:function(e,n,t){t.d(n,{Zo:function(){return d},kt:function(){return c}});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var o=r.createContext({}),p=function(e){var n=r.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},d=function(e){var n=p(e.components);return r.createElement(o.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,s=e.originalType,o=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),m=p(t),c=a,k=m["".concat(o,".").concat(c)]||m[c]||u[c]||s;return t?r.createElement(k,i(i({ref:n},d),{},{components:t})):r.createElement(k,i({ref:n},d))}));function c(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var s=t.length,i=new Array(s);i[0]=m;var l={};for(var o in n)hasOwnProperty.call(n,o)&&(l[o]=n[o]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var p=2;p<s;p++)i[p]=t[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},5277:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return l},contentTitle:function(){return o},metadata:function(){return p},toc:function(){return d},default:function(){return m}});var r=t(7462),a=t(3366),s=(t(7294),t(3905)),i=["components"],l={title:"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u044b \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432",sidebar_position:4},o="\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u044b \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432",p={unversionedId:"api/koa/parameters",id:"api/koa/parameters",isDocsHomePage:!1,title:"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u044b \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432",description:"\u0412\u0441\u0435 \u043c\u0435\u0442\u043e\u0434\u044b, \u0443\u0447\u0430\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u0432 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043d\u044b\u0445 \u0443\u0447\u0430\u0441\u0442\u043a\u0430\u0445 \u0434\u043e\u043b\u0436\u043d\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0434\u0435\u043a\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u044b, \u0447\u0442\u043e\u0431\u044b \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e",source:"@site/i18n/ru/docusaurus-plugin-content-docs/current/api/koa/parameters.md",sourceDirName:"api/koa",slug:"/api/koa/parameters",permalink:"/ru/docs/api/koa/parameters",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u044b \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432",sidebar_position:4},sidebar:"api",previous:{title:"\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043e\u0432",permalink:"/ru/docs/api/koa/middlewares"},next:{title:"\u041f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0430 OpenAPI",permalink:"/ru/docs/api/openapi/index"}},d=[{value:"Args",id:"args",children:[]},{value:"Ctx",id:"ctx",children:[]},{value:"Req, Res",id:"req-res",children:[]},{value:"Next",id:"next",children:[]},{value:"Err",id:"err",children:[{value:"\u0414\u0440\u0443\u0433\u0438\u0435 \u0441\u043f\u043e\u0441\u043e\u0431\u044b \u043f\u0435\u0440\u0435\u0445\u0432\u0430\u0442\u0430 \u043e\u0448\u0438\u0431\u043e\u043a",id:"\u0434\u0440\u0443\u0433\u0438\u0435-\u0441\u043f\u043e\u0441\u043e\u0431\u044b-\u043f\u0435\u0440\u0435\u0445\u0432\u0430\u0442\u0430-\u043e\u0448\u0438\u0431\u043e\u043a",children:[]}]},{value:"Query",id:"query",children:[]},{value:"Body",id:"body",children:[]},{value:"Params",id:"params",children:[]},{value:"Headers",id:"headers",children:[]},{value:"State",id:"state",children:[]},{value:"Session",id:"session",children:[]},{value:"Files",id:"files",children:[]},{value:"Cursor",id:"cursor",children:[]},{value:"Route",id:"route",children:[]},{value:"StateMap",id:"statemap",children:[]},{value:"This",id:"this",children:[]}],u={toc:d};function m(e){var n=e.components,t=(0,a.Z)(e,i);return(0,s.kt)("wrapper",(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"\u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u044b-\u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432"},"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u044b \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432"),(0,s.kt)("p",null,"\u0412\u0441\u0435 \u043c\u0435\u0442\u043e\u0434\u044b, \u0443\u0447\u0430\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u0432 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043d\u044b\u0445 \u0443\u0447\u0430\u0441\u0442\u043a\u0430\u0445 \u0434\u043e\u043b\u0436\u043d\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0434\u0435\u043a\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u044b, \u0447\u0442\u043e\u0431\u044b \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\n\u043e\u043f\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u043e\u043c \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439. \u0412\u0441\u0435 \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u044b \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044e\u0442 \u0438\u0437\u043e\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0432 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0435 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0430."),(0,s.kt)("h2",{id:"args"},"Args"),(0,s.kt)("p",null,"\u0411\u0430\u0437\u043e\u0432\u044b\u0439 \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 ",(0,s.kt)("inlineCode",{parentName:"p"},"@Args")," \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043e\u0431\u0449\u0443\u044e \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443 \u0434\u0430\u043d\u043d\u044b\u0445, \u044f\u0432\u043b\u044f\u044e\u0449\u0438\u0445\u0441\u044f \u0442\u0435\u043a\u0443\u0449\u0438\u043c \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u043e\u043c\n\u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u043c\u043e\u0433\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0430."),(0,s.kt)("p",null,"\u0412 \u043e\u0431\u0449\u0435\u043c \u0432\u0438\u0434\u0435 \u044d\u0442\u0430 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u0438\u043c\u0435\u0435\u0442 \u0432\u0438\u0434:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"interface IArgs {\n  ctx: Context;\n  next: Next;\n  route: IRoute;\n  cursor: ICursor;\n}\n")),(0,s.kt)("p",null,"\u0413\u0434\u0435:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"ctx")," \u0438 ",(0,s.kt)("inlineCode",{parentName:"li"},"next")," - \u0442\u0438\u043f\u043e\u0432\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f, \u043a\u043e\u0442\u043e\u0440\u044b\u043c\u0438 \u043e\u043f\u0435\u0440\u0438\u0440\u0443\u0435\u0442 ",(0,s.kt)("inlineCode",{parentName:"li"},"koa")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"route")," - \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430, \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u044e\u0449\u0430\u044f \u043d\u0430 \u043a\u043e\u043d\u0435\u0447\u043d\u0443\u044e \u0442\u043e\u0447\u043a\u0443 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"cursor")," - \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430, \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u044e\u0449\u0430\u044f \u043d\u0430 \u0442\u0435\u043a\u0443\u0449\u0443\u044e \u0442\u043e\u0447\u043a\u0443 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430")),(0,s.kt)("p",null,"\u041e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u043c\u0441\u044f \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u0435\u0435 \u043d\u0430 ",(0,s.kt)("inlineCode",{parentName:"p"},"cursor")," \u0438 ",(0,s.kt)("inlineCode",{parentName:"p"},"route"),", \u0442\u0430\u043a \u043a\u0430\u043a \u043e\u043d\u0438 \u0438\u0433\u0440\u0430\u044e\u0442 \u0432\u0430\u0436\u043d\u0443\u044e \u0440\u043e\u043b\u044c \u0432 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u0438 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\n\u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043e\u0432.\n\u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 ",(0,s.kt)("inlineCode",{parentName:"p"},"cursor")," \u0438\u043c\u0435\u0435\u0442 \u0432\u0438\u0434:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"interface ICursor {\n  constructor: Function; // \u043a\u043b\u0430\u0441\u0441, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432 \u0434\u0430\u043d\u043d\u044b\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f\n  property: string; // \u0438\u043c\u044f \u043c\u0435\u0442\u043e\u0434\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432 \u0434\u0430\u043d\u043d\u044b\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0438\u0441\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f\n  handler: Function; // \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u0444\u0443\u043d\u043a\u0446\u0438\u044f, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0432 \u0434\u0430\u043d\u043d\u044b\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0438\u0441\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f (handler === constructor[property])\n  prefix: string; // \u043f\u0440\u0435\u0444\u0438\u043a\u0441 \u0443\u0447\u0430\u0441\u0442\u043a\u0430 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043d\u043e\u0433\u043e \u043f\u0443\u0442\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432 \u0434\u0430\u043d\u043d\u044b\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u043f\u0440\u043e\u0445\u043e\u0434\u0438\u0442 \u043a\u0443\u0440\u0441\u043e\u0440\n}\n")),(0,s.kt)("p",null,"\u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 ",(0,s.kt)("inlineCode",{parentName:"p"},"route")," \u0438\u043c\u0435\u0435\u0442 \u0432\u0438\u0434:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"interface IRoute {\n  constructor: Function; // \u043a\u043b\u0430\u0441\u0441, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043a\u043e\u043d\u0435\u0447\u043d\u0443\u044e \u0442\u043e\u0447\u043a\u0443 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430\n  property: string; // \u0438\u043c\u044f \u043c\u0435\u0442\u043e\u0434\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u0437\u0432\u0430\u043d \u0432 \u043a\u043e\u043d\u0435\u0447\u043d\u043e\u0439 \u0442\u043e\u0447\u043a\u0435 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430\n  handler: Function; // \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u0444\u0443\u043d\u043a\u0446\u0438\u044f, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u0437\u0432\u0430\u043d\u0430 \u0432 \u043a\u043e\u043d\u0435\u0447\u043d\u043e\u0439 \u0442\u043e\u0447\u043a\u0435 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430 (handler === constructor[property])\n  method: string; // \u043c\u0435\u0442\u043e\u0434, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u043a\u043e\u043d\u0435\u0447\u043d\u043e\u0439 \u0442\u043e\u0447\u043a\u0438\n  path: string; // \u043f\u043e\u043b\u043d\u044b\u0439 \u043f\u0443\u0442\u044c \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430 (\u0432 \u0432\u0438\u0434\u0435 \u043f\u0430\u0442\u0442\u0435\u0440\u043d\u0430 \u0441 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c\u0438 `/files/:filename`)\n  cursors: ICursor[]; // \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u0441\u0435\u0445 \u043a\u0443\u0440\u0441\u043e\u0440\u043e\u0432, \u0441\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0445 \u0434\u0430\u043d\u043d\u044b\u0439 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\n  middlewares: Function[]; // \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u043a\u043e\u043c\u043f\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u0444\u0443\u043d\u043a\u0446\u0438\u0439, \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u044e\u0449\u0438\u0445\u0441\u044f \u0434\u043b\u044f \u0434\u0430\u043d\u043d\u043e\u0433\u043e endpoint \u0432 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0435 `koa` (\u0444\u0443\u043d\u043a\u0446\u0438\u0438 `(ctx, next)=> {...}`)\n}\n")),(0,s.kt)("p",null,"\u0420\u0430\u0441\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u043f\u0440\u0438\u043c\u0435\u0440 \u0432\u044b\u0437\u043e\u0432\u0430 \u043c\u0435\u0442\u043e\u0434\u0430 ",(0,s.kt)("inlineCode",{parentName:"p"},"GET /users/user_:id"),", \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432 \u043e\u0431\u0449\u0435\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u0441\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d \u0438\u0437 \u0446\u0435\u043f\u043e\u0447\u043a\u0438\n\u0437\u0430\u0434\u0435\u043a\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u043f\u0440\u0438 \u043f\u043e\u043c\u043e\u0449\u0438 ",(0,s.kt)("inlineCode",{parentName:"p"},"@Middleware"),", ",(0,s.kt)("inlineCode",{parentName:"p"},"@Bridge")," \u0438 ",(0,s.kt)("inlineCode",{parentName:"p"},"@Endpoint")," \u0441\u0442\u0430\u0442\u0438\u0447\u043d\u044b\u0445 \u043c\u0435\u0442\u043e\u0434\u043e\u0432 \u0442\u0440\u0435\u0445 \u043a\u043b\u0430\u0441\u0441\u043e\u0432:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"[Root.Init, Users.Init, Users.UserBridge, User.Init, User.Index];\n")),(0,s.kt)("p",null,"\u041f\u0440\u0438 \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0438 \u043a \u0434\u0430\u043d\u043d\u043e\u043c\u0443 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0443 \u0431\u0443\u0434\u0443\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0432\u044b\u0437\u0432\u0430\u043d\u044b \u0432\u0441\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0446\u0435\u043f\u043e\u0447\u043a\u0438, \u0438 \u0432 \u0441\u043b\u0443\u0447\u0430\u0435, \u0435\u0441\u043b\u0438\n\u043a\u0430\u0436\u0434\u0430\u044f \u0438\u0437 \u043d\u0438\u0445 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0432\u0435\u0440\u043d\u0435\u0442 ",(0,s.kt)("inlineCode",{parentName:"p"},"next"),"-\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435, \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u0437\u0432\u0430\u043d\u0430 \u043a\u043e\u043d\u0435\u0447\u043d\u0430\u044f \u0444\u0443\u043d\u043a\u0446\u0438\u044f, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u043e\u0436\u0438\u0434\u0430\u0435\u0442\u0441\u044f\n\u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442."),(0,s.kt)("p",null,"\u041d\u0430 \u043b\u044e\u0431\u043e\u043c \u0438\u0437 \u0443\u0447\u0430\u0441\u0442\u043a\u043e\u0432 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430 \u0432 \u043b\u044e\u0431\u043e\u0439 middleware \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 ",(0,s.kt)("inlineCode",{parentName:"p"},"route")," \u0431\u0443\u0434\u0435\u0442 \u0438\u043c\u0435\u0442\u044c \u0432\u0438\u0434:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},'{\n  constructor: User,\n  property: `Index`,\n  handler: User.Index,\n  method: "get",\n  path: "/users/user_:id",\n  cursors: [\n    { constructor: Root, property: "Init", handler: Root.Init, prefix: "/" },\n    { constructor: Users, property: "Init", handler: Users.Init, prefix: "/users" },\n    { constructor: Users, property: "UserBridge", handler: Users.UserBridge, prefix: "/users/user_:id", },\n    { constructor: User, property: "Init", handler: User.Init, prefix: "/users/user_:id" },\n    { constructor: User, property: "Index", handler: User.Index, prefix: "/users/user_:id" },\n  ],\n  middlewares: [async (ctx, next)=> {...}, ....]\n};\n')),(0,s.kt)("p",null,"\u0422\u0430\u043a\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c \u0432 \u043b\u044e\u0431\u043e\u043c \u043c\u0435\u0441\u0442\u0435 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430 \u043c\u043e\u0436\u043d\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u0442\u043e\u0447\u043a\u0435 \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f, \u0438 \u043f\u0440\u0438 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438\n\u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u043a\u0430\u043a\u0438\u0435-\u043b\u0438\u0431\u043e \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0438\u043b\u0438 \u0437\u0430\u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f."),(0,s.kt)("p",null,"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 ",(0,s.kt)("inlineCode",{parentName:"p"},"cursor")," \u0432 \u043a\u0430\u0436\u0434\u043e\u043c \u043c\u0435\u0441\u0442\u0435 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430 \u0431\u0443\u0434\u0435\u0442 \u043e\u0442\u043b\u0438\u0447\u0430\u0442\u044c\u0441\u044f.\n\u0414\u043b\u044f \u043f\u0435\u0440\u0432\u043e\u0433\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u043e\u043d \u0431\u0443\u0434\u0435\u0442 \u0440\u0430\u0432\u0435\u043d:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"{\n  constructor: Root,\n  property: `Init`,\n  handler: Root.Init,\n  prefix: '/'\n}\n")),(0,s.kt)("p",null,"\u0414\u043b\u044f \u0432\u0442\u043e\u0440\u043e\u0433\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 \u043e\u043d \u0431\u0443\u0434\u0435\u0442 \u0440\u0430\u0432\u0435\u043d:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"{\n  constructor: Users,\n  property: `Init`,\n  handler: Users.Init,\n  prefix: '/users'\n}\n")),(0,s.kt)("p",null,"\u0414\u043b\u044f \u0442\u0440\u0435\u0442\u044c\u0435\u0433\u043e:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"{\n  constructor: Users,\n  property: `UserBridge`,\n  handler: Users.UserBridge,\n  prefix: '/users/user_:id'\n}\n")),(0,s.kt)("p",null,"\u0414\u043b\u044f \u0447\u0435\u0442\u0432\u0435\u0440\u0442\u043e\u0433\u043e:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"{\n  constructor: User,\n  property: `Init`,\n  handler: User.Init,\n  prefix: '/users/user_:id'\n}\n")),(0,s.kt)("p",null,"\u0414\u043b\u044f \u043f\u044f\u0442\u043e\u0433\u043e:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"{\n  constructor: User,\n  property: `Index`,\n  handler: User.Index,\n  prefix: '/users/user_:id'\n}\n")),(0,s.kt)("p",null,"\u0422\u0430\u043a\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c \u043d\u0430 \u043a\u0430\u0436\u0434\u043e\u043c \u0448\u0430\u0433\u0435 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0430 \u0440\u0435\u0444\u043b\u0435\u043a\u0441\u0438\u0432\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u0442\u043e\u043c, \u043a\u0442\u043e \u0438 \u043d\u0430 \u043a\u0430\u043a\u043e\u043c\n\u0443\u0447\u0430\u0441\u0442\u043a\u0435 \u0435\u0433\u043e \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442. \u041c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u043e \u0434\u043b\u044f \u043b\u043e\u0433\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f, \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044f \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430\u043c, \u0430 \u0442\u0430\u043a\u0436\u0435\n\u043a \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044e \u0438 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044e \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0430 \u043b\u044e\u0431\u043e\u043c \u0438\u0437 \u0435\u0433\u043e \u0443\u0447\u0430\u0441\u0442\u043a\u043e\u0432."),(0,s.kt)("p",null,"\u041d\u0430\u043b\u0438\u0447\u0438\u0435 \u0432 ",(0,s.kt)("inlineCode",{parentName:"p"},"route")," \u0438 ",(0,s.kt)("inlineCode",{parentName:"p"},"cursor")," \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f ",(0,s.kt)("inlineCode",{parentName:"p"},"constructor")," \u0434\u0430\u0435\u0442 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0438\u0437 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b\n",(0,s.kt)("inlineCode",{parentName:"p"},"ctx.$StateMap = new WeakMap"),", \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0431\u043e\u043b\u0435\u0435 \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e \u0440\u0430\u0441\u0441\u043c\u0430\u0442\u0440\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u0432 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0438 \u043a \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u0430\u043c\n",(0,s.kt)("a",{parentName:"p",href:"#statemap"},(0,s.kt)("inlineCode",{parentName:"a"},"StateMap"))," \u0438 ",(0,s.kt)("a",{parentName:"p",href:"#this"},(0,s.kt)("inlineCode",{parentName:"a"},"This")),"."),(0,s.kt)("p",null,"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u043e\u0431\u044a\u0435\u043a\u0442\u0430 ",(0,s.kt)("inlineCode",{parentName:"p"},"route")," \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u043e \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u0442\u043e\u0447\u0435\u043a \u043d\u0430 \u0432\u0435\u0442\u043a\u0435 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0435. \u0417\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0432 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0435 ",(0,s.kt)("inlineCode",{parentName:"p"},"route"),"\n\u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u044b \u0437\u0430 \u0441\u0447\u0435\u0442 \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u0430 ",(0,s.kt)("a",{parentName:"p",href:"./middlewares#marker"},(0,s.kt)("inlineCode",{parentName:"a"},"@Marker"))," (\u043e\u043f\u0438\u0441\u0430\u043d \u043d\u0438\u0436\u0435)"),(0,s.kt)("p",null,"\u0414\u043b\u044f \u043e\u0431\u044a\u0435\u043a\u0442\u0430 ",(0,s.kt)("inlineCode",{parentName:"p"},"cursor")," \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 ",(0,s.kt)("inlineCode",{parentName:"p"},"constructor")," \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u043e \u0432 \u043e\u0441\u043e\u0431\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435: \u0435\u0441\u043b\u0438 \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u0435\u0442\u0441\u044f\n\u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 \u043f\u0435\u0440\u0435\u0433\u0440\u0443\u0437\u043a\u0438 ",(0,s.kt)("a",{parentName:"p",href:"./middlewares#sticker"},(0,s.kt)("inlineCode",{parentName:"a"},"Sticker"))," (\u043e\u043f\u0438\u0441\u0430\u043d \u043d\u0438\u0436\u0435)"),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 ",(0,s.kt)("inlineCode",{parentName:"p"},"Args")," \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u0440\u0438\u043d\u044f\u0442\u044c \u043d\u0430 \u0432\u0445\u043e\u0434 \u0444\u0443\u043d\u043a\u0446\u0438\u044e, \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u0431\u0443\u0434\u0435\u0442 \u043f\u0435\u0440\u0435\u0434\u0430\u043d\u0430 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 ",(0,s.kt)("inlineCode",{parentName:"p"},"IArgs"),",\n\u0438\u0437 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u0438\u0437\u0432\u043b\u0435\u0447\u0435\u043d\u044b \u0438 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0435\u043d\u044b \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f. \u0414\u043e\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0441\u044f \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0445 \u0444\u0443\u043d\u043a\u0446\u0438\u0439.\n\u041f\u0440\u0438\u043c\u0435\u0440:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},'import { Args, Get } from "aom";\nconst getUrl = (args) => args.ctx.url;\nclass Index {\n  @Get()\n  static Main(@Args(getUrl) url) {\n    return url;\n  }\n}\n')),(0,s.kt)("p",null,"\u0414\u043e\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0441\u044f \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0445 \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u043e\u0432 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f \u0432\u044b\u0437\u043e\u0432 ",(0,s.kt)("inlineCode",{parentName:"p"},"Args")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},'import { Args, Get } from "aom";\nconst Url = () => {\n  const handler = (args) => args.ctx.url;\n  return Args(handler);\n};\nclass Index {\n  @Get()\n  static Main(@Url() url) {\n    return url;\n  }\n}\n')),(0,s.kt)("p",null,"\u0412\u0441\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u044b \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0447\u0430\u0441\u0442\u043d\u044b\u043c\u0438 \u0441\u043b\u0443\u0447\u0430\u044f\u043c\u0438 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u0430 ",(0,s.kt)("inlineCode",{parentName:"p"},"@Args"),":"),(0,s.kt)("h2",{id:"ctx"},"Ctx"),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 ",(0,s.kt)("inlineCode",{parentName:"p"},"@Ctx()")," - \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0439 \u0434\u043b\u044f ",(0,s.kt)("inlineCode",{parentName:"p"},"koa")," \u043e\u0431\u044a\u0435\u043a\u0442 ",(0,s.kt)("inlineCode",{parentName:"p"},"ctx"),", \u043a \u043a\u043e\u0442\u043e\u0440\u043e\u043c\u0443 \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u044b\n\u0435\u0433\u043e \u0442\u0438\u043f\u043e\u0432\u044b\u0435 \u043c\u0435\u0442\u043e\u0434\u044b, \u0438\u0437\u0432\u043b\u0435\u0447\u0435\u043d\u044b \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0435 \u0438\u043b\u0438, \u0435\u0441\u043b\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043b\u0438\u0441\u044c \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438,\n\u043e\u0441\u043e\u0431\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f."),(0,s.kt)("h2",{id:"req-res"},"Req, Res"),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u044b ",(0,s.kt)("inlineCode",{parentName:"p"},"@Req()")," \u0438 ",(0,s.kt)("inlineCode",{parentName:"p"},"@Res()")," \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044e\u0442 \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0435 \u0434\u043b\u044f ",(0,s.kt)("inlineCode",{parentName:"p"},"koa")," \u043e\u0431\u044a\u0435\u043a\u0442\u044b ",(0,s.kt)("inlineCode",{parentName:"p"},"ctx.req")," \u0438 ",(0,s.kt)("inlineCode",{parentName:"p"},"ctx.res"),"\n\u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e. \u041d\u0435 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u044e\u0442 \u043d\u0438\u043a\u0430\u043a\u0438\u0445 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432, \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u044e\u0442 \u043d\u0430 \u043d\u0438\u0437\u043a\u043e\u043c \u0443\u0440\u043e\u0432\u043d\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0441 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u043e\u043c."),(0,s.kt)("h2",{id:"next"},"Next"),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 ",(0,s.kt)("inlineCode",{parentName:"p"},"@Next()")," \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u0443\u044e ",(0,s.kt)("inlineCode",{parentName:"p"},"next"),"-\u0444\u0443\u043d\u043a\u0446\u0438\u044e."),(0,s.kt)("p",null,"\u0412 \u043e\u0431\u0449\u0435\u043c \u0441\u043b\u0443\u0447\u0430\u0435 ",(0,s.kt)("inlineCode",{parentName:"p"},"next"),"-\u0444\u0443\u043d\u043a\u0446\u0438\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u043e \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u043e\u0439 ",(0,s.kt)("inlineCode",{parentName:"p"},"next"),"-\u0444\u0443\u043d\u043a\u0446\u0438\u0438 ",(0,s.kt)("inlineCode",{parentName:"p"},"koa"),": \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442,\n\u0447\u0442\u043e \u0434\u0430\u043b\u0435\u0435 \u043e\u0436\u0438\u0434\u0430\u0435\u0442\u0441\u044f \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0438\u0437 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0439 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0432 \u0446\u0435\u043f\u043e\u0447\u043a\u0435. \u0427\u0430\u0449\u0435 \u0432\u0441\u0435\u0433\u043e \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u0435\u0442\u0441\u044f \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\n\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f, \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u043e\u0433\u043e \u0432 ",(0,s.kt)("inlineCode",{parentName:"p"},"middleware"),"."),(0,s.kt)("p",null,"\u041f\u0440\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0438 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 ",(0,s.kt)("inlineCode",{parentName:"p"},"next"),"-\u0444\u0443\u043d\u043a\u0446\u0438\u044f \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0438\u0437 \u0434\u0440\u0443\u0433\u043e\u0433\u043e ",(0,s.kt)("inlineCode",{parentName:"p"},"endpoint"),"\n\u0438\u043b\u0438 ",(0,s.kt)("inlineCode",{parentName:"p"},"middleware"),". \u0412 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0441\u0442\u0430\u0442\u0438\u0447\u043d\u044b\u0445 \u043c\u0435\u0442\u043e\u0434\u043e\u0432, \u044f\u0432\u043b\u044f\u044e\u0449\u0438\u0445\u0441\u044f\n\u0442\u043e\u0447\u043a\u043e\u0439 \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0438\u043b\u0438 \u043f\u0440\u043e\u0441\u043b\u043e\u0439\u043a\u043e\u0439."),(0,s.kt)("p",null,"\u041f\u0440\u0438\u043c\u0435\u0440:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},'@Use(User.Init)\nclass User {\n  data: any;\n\n  @Middleware()\n  static async Init(@Params("user_id") userId, @This() user: User, @Next() next) {\n    user.data = await models.Users.findById(userId);\n    return next(); // \u043f\u0440\u0438 \u0432\u044b\u0437\u043e\u0432\u0435 \u0431\u0435\u0437 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442, \u0447\u0442\u043e \u043e\u0436\u0438\u0434\u0430\u0435\u0442\u0441\u044f \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0430\u044f \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u0432 \u0446\u0435\u043f\u043e\u0447\u043a\u0435\n  }\n\n  @Get()\n  static Info(@This() { data }: User) {\n    return data;\n  }\n\n  @Patch()\n  static async Update(@This() { data }: User, @Body() body, @Next() next) {\n    const { _id } = data;\n    await models.Users.update({ _id }, { $set: body });\n    // \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0446\u0435\u043f\u043e\u0447\u043a\u0443 middleware \u0438 endpoint\n    // \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 \u0438\u0445 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0438 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442, \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u043c\u0443 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e \u0432 \u0446\u0435\u043f\u043e\u0447\u043a\u0435\n    // \u043f\u0440\u0435\u0440\u044b\u0432\u0430\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0432 \u0441\u043b\u0443\u0447\u0430\u0435 \u043e\u0448\u0438\u0431\u043a\u0438\n    return next(User.Init, User.Info);\n  }\n}\n')),(0,s.kt)("h2",{id:"err"},"Err"),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 ",(0,s.kt)("inlineCode",{parentName:"p"},"@Err()")," \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 ",(0,s.kt)("inlineCode",{parentName:"p"},"error"),"-\u0444\u0443\u043d\u043a\u0446\u0438\u044e. \u0412 \u043e\u0431\u0449\u0435\u043c \u0441\u043b\u0443\u0447\u0430\u0435 ",(0,s.kt)("inlineCode",{parentName:"p"},"aom")," \u043e\u0442\u0440\u0435\u0430\u0433\u0438\u0440\u0443\u0435\u0442 \u043d\u0430 ",(0,s.kt)("inlineCode",{parentName:"p"},"throw")," \u0432 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u043e\u043c\n\u043c\u0435\u0441\u0442\u0435 \u0446\u0435\u043f\u043e\u0447\u043a\u0438 \u0432\u044b\u0437\u043e\u0432\u043e\u0432, \u0438 \u0432\u0435\u0440\u043d\u0435\u0442 \u0435\u0435 \u043a\u0430\u043a 500 \u043e\u0448\u0438\u0431\u043a\u0443 (\u0438\u043b\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 ",(0,s.kt)("inlineCode",{parentName:"p"},"status")," \u0438\u0437 \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \u043e\u0448\u0438\u0431\u043a\u0438)."),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"error"),"-\u0444\u0443\u043d\u043a\u0446\u0438\u044f, \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u0430\u044f \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u043e\u043c ",(0,s.kt)("inlineCode",{parentName:"p"},"@Err")," \u043f\u043e\u0437\u0432\u043e\u043b\u0438\u0442 \u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043e\u0448\u0438\u0431\u043a\u0443 \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u043c \u043a\u043e\u0434\u043e\u043c ",(0,s.kt)("inlineCode",{parentName:"p"},"status"),"\n\u0438 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0435\u0439 ",(0,s.kt)("inlineCode",{parentName:"p"},"data"),"."),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u043c \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440 \u043e\u0448\u0438\u0431\u043a\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0431\u0443\u0434\u0435\u0442 \u0441\u043e\u0437\u0434\u0430\u043d \u043f\u0440\u0438 \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438 \u043e\u0448\u0438\u0431\u043a\u0438.\n",(0,s.kt)("strong",{parentName:"p"},"\u0412\u0430\u0436\u043d\u043e"),": \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440 \u043e\u0448\u0438\u0431\u043a\u0438 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0443\u043d\u0430\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d \u043e\u0442 \u043a\u043b\u0430\u0441\u0441\u0430 ",(0,s.kt)("inlineCode",{parentName:"p"},"Error"),"."),(0,s.kt)("p",null,"\u0421\u043e\u0437\u0434\u0430\u0432\u0430\u0435\u043c\u0430\u044f ",(0,s.kt)("inlineCode",{parentName:"p"},"error"),"-\u0444\u0443\u043d\u043a\u0446\u0438\u044f \u043f\u0440\u0438 \u0432\u044b\u0437\u043e\u0432\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u044b:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"message: string - \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0431 \u043e\u0448\u0438\u0431\u043a\u0435, \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e"),(0,s.kt)("li",{parentName:"ul"},"status?: number - \u043a\u043e\u0434 \u043e\u0448\u0438\u0431\u043a\u0438, \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e 500"),(0,s.kt)("li",{parentName:"ul"},"data?: any - \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u0430\u044f \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u0441 \u0434\u0430\u043d\u043d\u044b\u043c\u0438 \u043e\u0431 \u043e\u0448\u0438\u0431\u043a\u0435")),(0,s.kt)("p",null,"\u0424\u0443\u043d\u043a\u0446\u0438\u044e \u043c\u043e\u0436\u043d\u043e \u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0447\u0435\u0440\u0435\u0437 ",(0,s.kt)("inlineCode",{parentName:"p"},"return")," \u0438\u043b\u0438 ",(0,s.kt)("inlineCode",{parentName:"p"},"throw"),".\n\u041f\u0440\u0438\u043c\u0435\u0440:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},'import { Params, Err, Next, Middleware } from "aom";\n\nclass ErrorResponse extends Error {\n  status: number;\n  data: any;\n  constructor(message, status = 500, data = undefined) {\n    this.message = message;\n    this.status = status;\n    this.data = data;\n  }\n\n  static toJSON() {\n    return { message: this.message, status: this.status, data: this.data };\n  }\n}\n\n@Use(User.Init)\nclass User {\n  @Middleware()\n  static async Init(@Params("user_id") userId, @Err(ErrorResponse) err, @Next() next) {\n    const user = await models.Users.findById(userId);\n    if (user) {\n      return next();\n    } else {\n      // \u0432\u0435\u0440\u043d\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0443 \u0441 \u043a\u043e\u0434\u043e\u043c 404 \u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435\u043c "user not found"\n      // \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 data \u0431\u0443\u0434\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044a\u0435\u043a\u0442 \u0441 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u043c, \u043d\u0435 \u043f\u0440\u043e\u0448\u0435\u0434\u0448\u0438\u043c \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443\n      // \u0431\u0443\u0434\u0435\u0442 \u0441\u043e\u0437\u0434\u0430\u043d \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440 \u043a\u043b\u0430\u0441\u0441\u0430 ErrorReponse\n      return err("user not found", 404, { user_id: userId });\n    }\n  }\n  // \u0438\u043b\u0438\n  @Middleware()\n  static async Init(@Params("user_id") userId, @Err() err, @Next() next) {\n    const user = await models.Users.findById(userId);\n    if (user) {\n      return next();\n    } else {\n      // \u0432\u0435\u0440\u043d\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0443 \u0441 \u043a\u043e\u0434\u043e\u043c 404 \u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435\u043c "user not found", \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 data \u0431\u0443\u0434\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\n      // \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u043e\u0448\u0438\u0431\u043a\u0438 \u0431\u0443\u0434\u0435\u0442 \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440 \u043a\u043b\u0430\u0441\u0441\u0430 Error\n      return err("user not found", 404, { user_id: userId });\n    }\n  }\n}\n')),(0,s.kt)("h3",{id:"\u0434\u0440\u0443\u0433\u0438\u0435-\u0441\u043f\u043e\u0441\u043e\u0431\u044b-\u043f\u0435\u0440\u0435\u0445\u0432\u0430\u0442\u0430-\u043e\u0448\u0438\u0431\u043e\u043a"},"\u0414\u0440\u0443\u0433\u0438\u0435 \u0441\u043f\u043e\u0441\u043e\u0431\u044b \u043f\u0435\u0440\u0435\u0445\u0432\u0430\u0442\u0430 \u043e\u0448\u0438\u0431\u043e\u043a"),(0,s.kt)("p",null,"\u0412\u044b\u0437\u043e\u0432 \u0437\u0430\u0434\u0435\u043a\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u043c\u0435\u0442\u043e\u0434\u043e\u0432 \u0432 ",(0,s.kt)("inlineCode",{parentName:"p"},"aom")," \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442 \u0432\u043d\u0443\u0442\u0440\u0438 \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0438 ",(0,s.kt)("inlineCode",{parentName:"p"},"try { } catch (e) { }"),": \u0442\u0430\u043a\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c\n\u043b\u044e\u0431\u043e\u0439 ",(0,s.kt)("inlineCode",{parentName:"p"},"throw")," \u0431\u0443\u0434\u0435\u0442 \u0438\u043d\u0442\u0435\u0440\u043f\u0440\u0435\u0442\u0438\u0440\u043e\u0432\u0430\u043d \u043a\u0430\u043a \u043e\u0448\u0438\u0431\u043a\u0430 \u043d\u0430 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0435, \u0434\u0430\u0436\u0435 \u0435\u0441\u043b\u0438 \u0431\u044b\u043b \u0432\u044b\u0437\u0432\u0430\u043d \u0441\u0442\u043e\u0440\u043e\u043d\u043d\u0435\u0439 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u043e\u0439,\n\u0438 \u0431\u0443\u0434\u0435\u0442 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0435\u043d \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f ",(0,s.kt)("inlineCode",{parentName:"p"},"ctx.body = e"),", \u043f\u0440\u0435\u0440\u0432\u0430\u0432 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430."),(0,s.kt)("p",null,"\u0412\u043c\u0435\u0441\u0442\u043e \u0432\u044b\u0437\u043e\u0432\u0430 ",(0,s.kt)("inlineCode",{parentName:"p"},"error"),"-\u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0442\u0430\u043a\u0436\u0435 \u043c\u043e\u0436\u043d\u043e \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0442\u044c \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440 \u043e\u0448\u0438\u0431\u043a\u0438: ",(0,s.kt)("inlineCode",{parentName:"p"},"aom")," \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442, \u0435\u0441\u043b\u0438\n\u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u043c\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u043c \u043e\u0448\u0438\u0431\u043a\u0438, \u0442\u043e \u043f\u0440\u0435\u043a\u0440\u0430\u0442\u0438\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430, \u0438 \u0432\u0435\u0440\u043d\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0443\n\u0441 \u043a\u043e\u0434\u043e\u043c 500, \u0438\u043b\u0438 \u0441\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c ",(0,s.kt)("inlineCode",{parentName:"p"},"status"),", \u0435\u0441\u043b\u0438 \u0442\u0430\u043a\u043e\u0432\u043e\u0435 \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0438."),(0,s.kt)("p",null,"\u0422\u0430\u043a\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c, \u0432\u043c\u0435\u0441\u0442\u043e ",(0,s.kt)("inlineCode",{parentName:"p"},"error"),"-\u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u0442\u0438\u043f \u043e\u0448\u0438\u0431\u043e\u043a, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0443\u043d\u0430\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\n\u043e\u0442 \u043a\u043b\u0430\u0441\u0441\u0430 ",(0,s.kt)("inlineCode",{parentName:"p"},"Error"),"."),(0,s.kt)("p",null,"\u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},'// ... \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c \u043a\u043b\u0430\u0441\u0441 ErrorResponse, \u043e\u043f\u0438\u0441\u0430\u043d\u043d\u044b\u0439 \u0432\u044b\u0448\u0435\nclass Auth {\n  @Middleware()\n  static Required(@Next() next, @Headers("authorization") token) {\n    if (await models.Auth.checkToken(token)) {\n      return next();\n    } else {\n      return new ErrorResponse("access denied", 403);\n    }\n  }\n}\n')),(0,s.kt)("h2",{id:"query"},"Query"),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 ",(0,s.kt)("inlineCode",{parentName:"p"},"@Query()")," \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 ",(0,s.kt)("inlineCode",{parentName:"p"},"ctx.query"),", \u0442\u0438\u043f\u0438\u0447\u043d\u043e\u0435 \u0434\u043b\u044f ",(0,s.kt)("inlineCode",{parentName:"p"},"koa"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},'import { Get, Query } from "aom";\nimport fs from "fs";\n\nclass Files {\n  @Get()\n  static Index(@Query() query) {\n    const { name } = query;\n    return fs\n      .readdirSync(__dirname)\n      .filter((filename) => (name ? filename.search(name) >= 0 : true));\n  }\n}\n')),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u044e-\u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u043c\u043e\u0436\u043d\u043e \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c\n\u0438\u043b\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0432\u0445\u043e\u0434\u044f\u0449\u0435\u0433\u043e \u043e\u0431\u044a\u0435\u043a\u0442\u0430."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},'const QueryParser = (query) => {\n  const { offset = 0, limit = 10, sort = "name", ...where } = query;\n  return { offset, limit, sort, where };\n};\n\nclass Users {\n  @Get("/search")\n  static Search(@Query(QueryParser) { where, offset, sort, limit }) {\n    return models.Users.find(where).order(sort).offset(offset).limit(limit);\n  }\n}\n')),(0,s.kt)("h2",{id:"body"},"Body"),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 ",(0,s.kt)("inlineCode",{parentName:"p"},"@Body()")," \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 ",(0,s.kt)("inlineCode",{parentName:"p"},"ctx.request.body"),", \u0442\u0438\u043f\u0438\u0447\u043d\u043e\u0435 \u0434\u043b\u044f ",(0,s.kt)("inlineCode",{parentName:"p"},"koa"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},'import { Get, Body } from "aom";\nimport fs from "fs";\n\nclass Users {\n  @Post()\n  static save(@Body() body) {\n    return models.Users.create(body);\n  }\n}\n')),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0430 \u0444\u0443\u043d\u043a\u0446\u0438\u044e-\u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u043c\u043e\u0436\u043d\u043e \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c\n\u0438\u043b\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0432\u0445\u043e\u0434\u044f\u0449\u0435\u0433\u043e \u043e\u0431\u044a\u0435\u043a\u0442\u0430."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},'// \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0442\u0441\u044f `class-transformer` \u0438 `class-validator`, \u043f\u043e\u0434\u0440\u0430\u0437\u0443\u043c\u0435\u0432\u0430\u044f, \u0447\u0442\u043e \u0432 \u043c\u043e\u0434\u0435\u043b\u0438 \u0434\u0430\u043d\u043d\u044b\u0445\n// \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u044e\u0442\u0441\u044f \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u044b\nimport { plainToClass } from "class-transformer";\nimport { validate } from "class-validator";\n// \u0440\u0430\u0437\u0440\u0435\u0448\u0430\u0435\u0442\u0441\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438\nconst ValidateBody = async (body) => {\n  const safeBody = plainToClass(models.Users, { ...body });\n  const validateErrors = await validate(safeBody, { whitelist: true });\n\n  if (validateErrors.length) {\n    throw Object.assign(new Error("validation error"), { data: validateErrors });\n  }\n  return safeBody;\n};\n\nclass Users {\n  @Post("/add")\n  static Add(@Body(ValidateBody) userData) {\n    // \u0432 `userData` \u0437\u0430\u0432\u0435\u0434\u043e\u043c\u043e \u0442\u043e\u0447\u043d\u043e \u0431\u0443\u0434\u0443\u0442 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0442\u044c \u0432 \u0431\u0430\u0437\u0443\n    return models.Users.create({ ...userData });\n  }\n}\n')),(0,s.kt)("h2",{id:"params"},"Params"),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 ",(0,s.kt)("inlineCode",{parentName:"p"},"@Params()")," \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f ",(0,s.kt)("inlineCode",{parentName:"p"},"ctx.params"),", \u0442\u0438\u043f\u0438\u0447\u043d\u043e\u0435 \u0434\u043b\u044f ",(0,s.kt)("inlineCode",{parentName:"p"},"koa"),". \u041c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c\n\u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0430 \u0438\u043c\u044f \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430, \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044f \u0435\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},'import { Get, Middleware, Params, Next } from "aom";\n\nclass User {\n  @Middleware()\n  static async Init(@Params() params, @Next() next) {\n    const user = await models.Users.findById(params.user_id);\n    return next();\n  }\n  // \u0438\u043b\u0438\n  @Middleware()\n  static async Init(@Params("user_id") userId, @Next() next) {\n    const user = await models.Users.findById(userId);\n    return next();\n  }\n}\n')),(0,s.kt)("h2",{id:"headers"},"Headers"),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 ",(0,s.kt)("inlineCode",{parentName:"p"},"@Headers()")," \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f ",(0,s.kt)("inlineCode",{parentName:"p"},"ctx.headers"),", \u0442\u0438\u043f\u0438\u0447\u043d\u043e\u0435 \u0434\u043b\u044f ",(0,s.kt)("inlineCode",{parentName:"p"},"koa"),". \u041c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c\n\u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0430 \u0438\u043c\u044f \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430, \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044f \u0435\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},'import { Get, Headers, Middleware, Next } from "aom";\n\nclass Auth {\n  @Middleware()\n  static async Init(@Headers() headers, @Next() next) {\n    const checkToken = await models.Auth.checkToken(headers.authorization);\n    return next();\n  }\n  // \u0438\u043b\u0438\n  @Middleware()\n  static async Init(@Headers("authorization") authToken, @Next() next) {\n    const checkToken = await models.Auth.checkToken(authToken);\n    return next();\n  }\n}\n')),(0,s.kt)("h2",{id:"state"},"State"),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 ",(0,s.kt)("inlineCode",{parentName:"p"},"@State()")," \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f ",(0,s.kt)("inlineCode",{parentName:"p"},"ctx.state"),", \u0442\u0438\u043f\u0438\u0447\u043d\u043e\u0435 \u0434\u043b\u044f ",(0,s.kt)("inlineCode",{parentName:"p"},"koa"),". \u041c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c\n\u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0430 \u0438\u043c\u044f \u0430\u0442\u0442\u0440\u0438\u0431\u0443\u0442\u0430, \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044f \u0435\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},'import { Get, State, Params, Middleware, Next } from "aom";\n\n@Use(User.Init)\nclass User {\n  // \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0432 state\n  @Middleware()\n  static async Init(@State() state, @Params("user_id") userId, @Next() next) {\n    state.user = await models.Users.findById(userId);\n    return next();\n  }\n\n  // \u0438\u0437\u0432\u043b\u0435\u0447\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0438\u0437 state\n  @Get()\n  static async Index(@State("user") user) {\n    return user;\n  }\n}\n')),(0,s.kt)("h2",{id:"session"},"Session"),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 ",(0,s.kt)("inlineCode",{parentName:"p"},"@Session()")," \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f ",(0,s.kt)("inlineCode",{parentName:"p"},"ctx.session"),", \u0442\u0438\u043f\u0438\u0447\u043d\u043e\u0435 \u0434\u043b\u044f ",(0,s.kt)("inlineCode",{parentName:"p"},"koa"),". \u041c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c\n\u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0430 \u0438\u043c\u044f \u0430\u0442\u0442\u0440\u0438\u0431\u0443\u0442\u0430, \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044f \u0435\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435."),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"\u0412\u0430\u0436\u043d\u043e"),": \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c middleware-\u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438 \u0434\u043b\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u0441\u0435\u0441\u0441\u0438\u0439 \u0432 ",(0,s.kt)("inlineCode",{parentName:"p"},"koa"),"\n(\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440: ",(0,s.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/koa-session"},(0,s.kt)("inlineCode",{parentName:"a"},"koa-session")),")"),(0,s.kt)("p",null,"\u041f\u0440\u0438\u043c\u0435\u0440:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},'import { Middleware, Post, Delete, Session, Body } from "aom";\n\n@Use(Basket.Init)\nclass Basket {\n  // \u0443\u0431\u0435\u0434\u0438\u043c\u0441\u044f, \u0447\u0442\u043e \u0435\u0441\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u043b\u044f \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0442\u043e\u0432\u0430\u0440\u043e\u0432 \u0432 \u043a\u043e\u0440\u0437\u0438\u043d\u0435\n  @Middleware()\n  static Init(@Session() session, @Next() next) {\n    if (!session.basket) {\n      session.basket = [];\n    }\n    return next();\n  }\n  // \u0434\u043e\u0431\u0430\u0432\u0438\u043c \u043f\u0440\u0435\u0434\u043c\u0435\u0442 \u0432 \u043a\u043e\u0440\u0437\u0438\u043d\u0443\n  @Post()\n  static async AddItem(@Body() item, @Session("basket") basket) {\n    basket.push(item);\n    return basket;\n  }\n\n  // \u043e\u0447\u0438\u0441\u0442\u0438\u043c \u043a\u043e\u0440\u0437\u0438\u043d\u0443\n  @Delete()\n  static async Clear(@Session() session) {\n    session.basket = [];\n    return basket;\n  }\n}\n')),(0,s.kt)("h2",{id:"files"},"Files"),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 ",(0,s.kt)("inlineCode",{parentName:"p"},"@Files()")," \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 ",(0,s.kt)("inlineCode",{parentName:"p"},"ctx.request.files"),", \u0442\u0438\u043f\u0438\u0447\u043d\u043e\u0433\u043e \u0434\u043b\u044f \u0431\u043e\u043b\u044c\u0448\u0438\u043d\u0441\u0442\u0432\u0430\n\u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a ",(0,s.kt)("inlineCode",{parentName:"p"},"koa"),", \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u044e\u0449\u0435\u0433\u043e \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0442\u044c \u0444\u0430\u0439\u043b\u044b."),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"\u0412\u0430\u0436\u043d\u043e"),": \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c middleware-\u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438 \u0434\u043b\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0444\u0430\u0439\u043b\u043e\u0432 \u0432 ",(0,s.kt)("inlineCode",{parentName:"p"},"koa"),"\n(\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440: ",(0,s.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/koa-body"},(0,s.kt)("inlineCode",{parentName:"a"},"koa-body")),")"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},'import { Post, Files } from "aom";\nimport fs from "fs";\nimport path from "path";\n\nclass Files {\n  // \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u043e\u0434\u043d\u043e\u0433\u043e \u0444\u0430\u0439\u043b\u0430\n  @Post()\n  static UploadFiles(@Files("file") file: File) {\n    const filename = path.join(__dirname, file.name);\n    fs.renameSync(file.path, filename);\n    return file;\n  }\n  // \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u0444\u0430\u0439\u043b\u043e\u0432\n  @Post("/mass_upload")\n  static UploadFiles(@Files() files: Record<string, File>) {\n    const filenames = [];\n    Object.keys(files).forEach((key) => {\n      const file = files[key];\n      const filename = path.join(__dirname, file.name);\n      fs.renameSync(file.path, filename);\n      filenames.push(filename);\n    });\n    return filenames;\n  }\n}\n')),(0,s.kt)("h2",{id:"cursor"},"Cursor"),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 ",(0,s.kt)("inlineCode",{parentName:"p"},"@Cursor()")," \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 ",(0,s.kt)("inlineCode",{parentName:"p"},"cursor"),", \u043e\u043f\u0438\u0441\u0430\u043d\u043d\u043e\u0435 \u0432\u044b\u0448\u0435."),(0,s.kt)("h2",{id:"route"},"Route"),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 ",(0,s.kt)("inlineCode",{parentName:"p"},"@Route()")," \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 ",(0,s.kt)("inlineCode",{parentName:"p"},"route"),", \u043e\u043f\u0438\u0441\u0430\u043d\u043d\u043e\u0435 \u0432\u044b\u0448\u0435."),(0,s.kt)("h2",{id:"statemap"},"StateMap"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"aom")," \u0440\u0430\u0441\u0448\u0438\u0440\u044f\u0435\u0442 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 ",(0,s.kt)("inlineCode",{parentName:"p"},"koa")," \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u043e\u0439 \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0435\u0439 ",(0,s.kt)("inlineCode",{parentName:"p"},"ctx.$StateMap = new WeakMap()"),", \u043a\u043e\u0442\u043e\u0440\u043e\u0435\n\u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0442\u044c \u0432 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0435 \u0441\u0432\u044f\u0437\u0438, \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u043d\u0430 \u0430\u0441\u0441\u043e\u0446\u0438\u0430\u0446\u0438\u044f\u0445 \u0441 \u0430\u0431\u0441\u0442\u0440\u0430\u043a\u0442\u043d\u044b\u043c\u0438 \u043a\u043b\u044e\u0447\u0430\u043c\u0438. \u0412 \u0447\u0430\u0441\u0442\u043d\u043e\u0441\u0442\u0438\n\u0434\u043b\u044f ",(0,s.kt)("inlineCode",{parentName:"p"},"aom")," \u044d\u0442\u043e \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0442\u044c \u0430\u0441\u0441\u043e\u0446\u0438\u0430\u0446\u0438\u0438 \u043d\u0430 \u043a\u043b\u0430\u0441\u0441\u0430\u0445, \u043e\u0431\u0440\u0430\u0437\u0443\u044e\u0449\u0438\u0445 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043d\u044b\u0435 \u0443\u0437\u043b\u044b."),(0,s.kt)("p",null,"\u041d\u0430\u0438\u0431\u043e\u043b\u0435\u0435 \u0447\u0430\u0441\u0442\u044b\u0439 \u0441\u043f\u043e\u0441\u043e\u0431 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f ",(0,s.kt)("inlineCode",{parentName:"p"},"@StateMap()")," - \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u0432 ",(0,s.kt)("inlineCode",{parentName:"p"},"middleware"),"-\u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f\n\u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440\u043e\u0432 \u043a\u043b\u0430\u0441\u0441\u0430 \u0441 \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u043c \u0438\u0445 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435\u043c \u0432 \u0434\u0440\u0443\u0433\u0438\u0445 \u043c\u0435\u0442\u043e\u0434\u0430\u0445."),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 ",(0,s.kt)("inlineCode",{parentName:"p"},"StateMap")," \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u0435\u0440\u043d\u0435\u0442 \u0438\u0437 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e \u043a\u043b\u044e\u0447\u0443, \u0440\u0430\u0432\u043d\u043e\u043c\u0443 \u044d\u0442\u043e\u043c\u0443\n\u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0443."),(0,s.kt)("p",null,"\u041f\u0440\u0438\u043c\u0435\u0440:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},'class Auth {\n  user: models.Users;\n  login: models.UserLogins;\n  // \u0441\u043e\u0437\u0434\u0430\u0434\u0438\u043c \u043f\u0440\u043e\u0441\u043b\u043e\u0439\u043a\u0443, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u043f\u043e \u0442\u043e\u043a\u0435\u043d\u0443 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442, \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430 \u043b\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f\n  // \u0438 \u0435\u0441\u043b\u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430, \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442 \u0432 stateMap \u043f\u043e \u043a\u043b\u044e\u0447\u0443 \u043a\u043b\u0430\u0441\u0441\u0430 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u043e\u043d\u043d\u0443\u044e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e: \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0438 \u043b\u043e\u0433\u0438\u043d\n  @Middleware()\n  static Init(@Headers("authorization") token, @Next() next, @StateMap() stateMap, @Err() err) {\n    const authData = models.Auth.checkToken(token);\n    if (authData) {\n      const auth = new this(); // \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 \u043c\u0435\u0442\u043e\u0434 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0441 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435\u043c \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0430, \u0442\u043e `this` - \u044d\u0442\u043e \u043a\u043b\u0430\u0441\u0441 `Auth`\n      auth.user = await models.Users.findById(authData.userId);\n      auth.login = await models.UserLogins.findById(authData.userLoginId);\n      stateMap.set(this, auth);\n    } else {\n      return err("wrong auth", 403, { token });\n    }\n  }\n}\n// ... \u0437\u0430\u0442\u0435\u043c \u0438\u0437\u0432\u043b\u0435\u0447\u0435\u043c \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u043e\u043d\u043d\u043e\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u0432 \u0434\u0440\u0443\u0433\u043e\u043c middleware \u0438\u043b\u0438 endpoint\n\n@Use(Auth.Init) // \u043e\u0442\u043c\u0435\u0442\u0438\u043c, \u0447\u0442\u043e \u0434\u043b\u044f \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043d\u043e\u043c\u0443 \u0443\u0437\u043b\u0443 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u0430\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f\nclass Account {\n  // \u044d\u0442\u043e\u0442 \u043c\u0435\u0442\u043e\u0434 \u0431\u0443\u0434\u0435\u0442 \u0433\u0430\u0440\u0430\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e \u0432\u044b\u0437\u0432\u0430\u043d, \u0435\u0441\u043b\u0438 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u043f\u043e \u0442\u043e\u043a\u0435\u043d\u0443 \u0431\u044b\u043b\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0432\u0435\u0440\u0448\u0435\u043d\u0430\n  // \u0430 \u0437\u043d\u0430\u0447\u0438\u0442 \u0432 StateMap \u0431\u0443\u0434\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e \u043a\u043b\u044e\u0447\u0443 Auth, \u044f\u0432\u043b\u044f\u044e\u0449\u0435\u0435\u0441\u044f \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440\u043e\u043c \u044d\u0442\u043e\u0433\u043e \u043a\u043b\u0430\u0441\u0441\u0430\n  // \u0441 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u043c\u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u043c\u0438\n  @Get()\n  static async Index(@StateMap(Auth) auth: Auth, @Next() next) {\n    const { user, login } = auth;\n    // \u043f\u043e\u0441\u043a\u043e\u043b\u044c\u043a\u0443 user - \u044d\u0442\u043e \u043e\u0431\u044a\u0435\u043a\u0442 \u043c\u043e\u0434\u0435\u043b\u0438 \u0434\u0430\u043d\u043d\u044b\u0445 `models.Users`, \u0442\u043e \u0434\u043b\u044f \u043d\u0435\u0433\u043e \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b \u0432\u0441\u0435 \u0435\u0433\u043e \u043c\u0435\u0442\u043e\u0434\u044b\n    const stat = await user.getStat();\n    return { user, login, stat };\n  }\n}\n')),(0,s.kt)("p",null,"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 ",(0,s.kt)("inlineCode",{parentName:"p"},"WeakMap")," \u043e\u0431\u0443\u0441\u043b\u043e\u0432\u043b\u0435\u043d\u043d\u043e \u043a\u0440\u0438\u0442\u0435\u0440\u0438\u044f\u043c\u0438 \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u0438 \u0438 \u043e\u043f\u0442\u0438\u043c\u0438\u0437\u0430\u0446\u0438\u0438 \u043f\u0430\u043c\u044f\u0442\u0438 \u0434\u043b\u044f \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439.\n\u041f\u0440\u0438 \u0436\u0435\u043b\u0430\u043d\u0438\u0438 \u0435\u0433\u043e \u043c\u043e\u0436\u043d\u043e \u043f\u0435\u0440\u0435\u0433\u0440\u0443\u0437\u0438\u0442\u044c, \u0441\u043e\u0437\u0434\u0430\u0432 ",(0,s.kt)("inlineCode",{parentName:"p"},"middleware"),", \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u0431\u0443\u0434\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u043e \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 ",(0,s.kt)("inlineCode",{parentName:"p"},"Map"),"."),(0,s.kt)("p",null,"\u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},'@Use(Root.Init) // Root.Init \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c\u0441\u044f \u043f\u0435\u0440\u0435\u0434 \u0432\u0441\u0435\u043c\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430\u043c\u0438 \u0432\u043e \u0432\u0441\u0435\u0445 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043d\u044b\u0445 \u0432\u0435\u0442\u043a\u0430\u0445\n@Bridge("/files", Files)\n@Bridge("/users", Users)\nclass Root {\n  @Middleware()\n  static Init(@Ctx() ctx, @Next() next) {\n    ctx.$StateMap = new Map();\n    return next();\n  }\n\n  @Get()\n  static Index() {\n    return "index page";\n  }\n}\n')),(0,s.kt)("h2",{id:"this"},"This"),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 ",(0,s.kt)("inlineCode",{parentName:"p"},"@This()")," \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435\u043c \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u0430 ",(0,s.kt)("inlineCode",{parentName:"p"},"@StateMap()"),". \u041e\u043d \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442, \u0435\u0441\u0442\u044c \u043b\u0438 \u0432 ",(0,s.kt)("inlineCode",{parentName:"p"},"ctx.$StateMap"),"\n\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e \u043a\u043b\u044e\u0447\u0443, \u0440\u0430\u0432\u043d\u043e\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e ",(0,s.kt)("inlineCode",{parentName:"p"},"constructor")," \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u043c ",(0,s.kt)("inlineCode",{parentName:"p"},"cursor"),". \u0422\u0430\u043a\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c \u0432 \u043e\u0431\u0449\u0435\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u043e\u043d\n\u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442, \u0435\u0441\u0442\u044c \u043b\u0438 \u0432 ",(0,s.kt)("inlineCode",{parentName:"p"},"StateMap")," \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043a\u043b\u0430\u0441\u0441\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441\u0435\u0439\u0447\u0430\u0441 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u0443, \u0438 \u0435\u0441\u043b\u0438 \u043d\u0435\u0442,\n\u0441\u043e\u0437\u0434\u0430\u0435\u0442 \u0435\u0433\u043e singletone-\u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440 \u0438 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435."),(0,s.kt)("p",null,"\u041d\u0430\u0438\u0431\u043e\u043b\u0435\u0435 \u0447\u0430\u0441\u0442\u044b\u0439 \u0441\u043f\u043e\u0441\u043e\u0431 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u0430 ",(0,s.kt)("inlineCode",{parentName:"p"},"@This()")," - \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0432 \u0438\u043d\u0438\u0446\u0438\u0440\u0443\u044e\u0449\u0435\u0439 ",(0,s.kt)("inlineCode",{parentName:"p"},"middleware"),"\n\u0438 ",(0,s.kt)("inlineCode",{parentName:"p"},"endpoint"),"-\u0430\u0445 \u043e\u0434\u043d\u043e\u0433\u043e \u0438 \u0442\u043e\u0433\u043e \u0436\u0435 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u043d\u043e\u0433\u043e \u0443\u0437\u043b\u0430."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},'@Use(User.Init)\nclass User {\n  user: models.Users;\n  stat: any;\n\n  @Middleware()\n  static async Init(@Params() { user_id }, @Next() next, @Err() err, @This() _this: User) {\n    const userInfo = await models.Users.findById(user_id);\n    if (userInfo) {\n      _this.user = userInfo;\n      _this.stat = await userInfo.getStat();\n      return next();\n    } else {\n      return err("user not found", 404);\n    }\n  }\n\n  @Get()\n  static Info(@This() user: User) {\n    return user; // \u0432\u0435\u0440\u043d\u0435\u0442 { user, stat }\n  }\n\n  @Delete()\n  static async Delete(@This() { user }: User) {\n    const result = await user.delete();\n    return result;\n  }\n}\n')),(0,s.kt)("p",null,"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 ",(0,s.kt)("inlineCode",{parentName:"p"},"@This()")," \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0442\u044c \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0430, \u0434\u0440\u0443\u0433\u043e\u0439 \u043a\u043b\u0430\u0441\u0441. \u0412 \u044d\u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u0431\u0443\u0434\u0435\u0442 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0435\u043d\u043e\n\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043a\u043b\u0430\u0441\u0441\u0430 \u0438\u0437 ",(0,s.kt)("inlineCode",{parentName:"p"},"ctx.$StateMap"),", \u0430, \u0435\u0441\u043b\u0438 \u0435\u0433\u043e \u0442\u0430\u043c \u043d\u0435 \u0431\u044b\u043b\u043e, \u0431\u0443\u0434\u0435\u0442 \u0441\u043e\u0437\u0434\u0430\u043d \u0438 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0435\u043d \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440\n\u044d\u0442\u043e\u0433\u043e \u043a\u043b\u0430\u0441\u0441\u0430, \u0441 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435\u043c \u043f\u043e \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u043c\u0443 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0443 \u0432 ",(0,s.kt)("inlineCode",{parentName:"p"},"ctx.$StateMap"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},'class Files {\n  where = {};\n\n  @Get()\n  static Index(@This() { where }: Files) {\n    return models.Files.find({ ...where });\n  }\n}\n\n// ...\nclass User {\n  user: models.Users;\n\n  @Bridge("/files", Files)\n  static userFiles(@This() { user }: User, @This(Files) files: Files, @Next() next) {\n    files.where = { userId: user.id };\n    return next();\n  }\n}\n')),(0,s.kt)("p",null,"\u0422\u0430\u043a\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u0430 ",(0,s.kt)("inlineCode",{parentName:"p"},"@StateMap()")," \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043f\u043e \u043a\u043b\u044e\u0447\u0443 \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435,\n\u0432 \u0442\u043e \u0432\u0440\u0435\u043c\u044f \u043a\u0430\u043a ",(0,s.kt)("inlineCode",{parentName:"p"},"@This()")," \u0432\u0441\u0435\u0433\u0434\u0430 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 singletone-\u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440 \u043a\u043b\u0430\u0441\u0441\u0430, \u043f\u0435\u0440\u0435\u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0432 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0435 \u0438\u043b\u0438\n\u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u043c \u043a\u0443\u0440\u0441\u043e\u0440\u0435."),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"\u0412\u0430\u0436\u043d\u043e"),": \u0432\u0441\u0435 \u043a\u043b\u0430\u0441\u0441\u044b, \u0434\u043b\u044f \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u0442\u044c\u0441\u044f \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 ",(0,s.kt)("inlineCode",{parentName:"p"},"@This"),", \u0434\u043e\u043b\u0436\u043d\u044b \u0443\u043c\u0435\u0442\u044c \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u0442\u044c \u0441\u0432\u043e\u0438\n\u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440\u044b \u0431\u0435\u0437 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432, \u0442\u0430\u043a \u043a\u0430\u043a \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440 \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0443 \u043a\u0430\u043a\u0438\u0445-\u043b\u0438\u0431\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \u0432 \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440."))}m.isMDXComponent=!0}}]);