---
title: Конечные точки
sidebar_position: 2
---

## Конечные точки маршрутов

Все `endpoint`-ы создаются при помощи декораторов из следующего списка:

- `@Endpoint(method = 'get'|'post'|'put'|'patch'|'delete'|'options'|'all', path )` - указывает,
  что создается `endpoint`, указывающий на адрес `path`, и доступный через метод `method`. Чтобы создать
  endpoint через данный декоратор, необходимо указать как минимум используемый метод. Вызов данного
  декоратора без аргументов создает общий endpoint (подробнее ниже). По умолчанию значение `path='/'`.
- `@Get(path)` - сокращение для `@Endpoint('get', path)`
- `@Post(path)` - сокращение для `@Endpoint('post', path)`
- `@Put(path)` - сокращение для `@Endpoint('put', path)`
- `@Patch(path)` - сокращение для `@Endpoint('patch', path)`
- `@Delete(path)` - сокращение для `@Endpoint('delete', path)`
- `@Options(path)` - сокращение для `@Endpoint('options', path)`
- `@All(path)` - сокращение для `@Endpoint('all', path)`

Все декораторы сокращений применяются над статичными методами класса без второго аргумента. Использование
второго агумента применяется только для общих точек назначения (описано ниже), и используются как
декораторы класса.

Значение `path` может иметь несколько уровней вложенности, и даже содержать типовой `koa-router`-параметр.
В качестве значения ссылки используется фрагмент адреса, который характеризует данный метод исключительно
в пределах данного маршрутного узла. Полное имя адреса будет построено на основании всех связей,
которые предшествовали данному `endpoint`-у.

Указанные декораторы следующим образом:

```ts
// ... index.ts
import { Get, Post, Body, Params } from "aom";

class Index {
  @Get()
  static Hello() {
    return `Hello, I'm aom`;
  }

  @Post("/save")
  static Save(@Body() body: any) {
    return body;
  }

  @Get("/choose/:variant")
  static Variant(@Params("variant") variant) {
    return { variant };
  }
}
```

Таким образом будет создан маршрутный элемент, обладающий методами: `GET /`, `POST /save` и
`GET /choose/:variant`, который, после подключения в маршрутную карту, предоставит к ним доступ
с учетом возможных префиксов.

## Общие endpoint-ы

`aom` позволяет создать общие точки назначения, позволяя использовать повторно один и тот же
код в разных местах по разному адресу доступа и, если необходимо, по разному методу.

Для объявления метода класса общей точкой назначения, используется декоратор `@Endpoint()` без
аргументов. После чего данный метод может быть использован в качестве второго аргумента для декораторов
сокращений, примененных к классу, в котором требуется использовать данные методы.

Пример:

```ts
// создадим два общих endpoint-а, которые используют значение модели данных из контекстного состояния
class Data {
  @Endpoint()
  static List(@State() { model }, @Query() query) {
    return model.find({ ...query });
  }

  @Endpoint()
  static Add(@State() { model }, @Body() body) {
    return model.create({ ...body });
  }
}

// создадим маршрутный узел, в котором при инициации будет объявлена модель данных `Users`
// и подключим в нее ранее объявленные точки назначения по указанному пути и методам
@Use(Users.Init)
@Get("/", Data.List)
@Post("/", Data.Add)
class Users {
  model = models.Users;

  @Middleware()
  static Init(@State() state, @This() { model }: Users, @Next() next) {
    Object.assign(state, { model });
    return next();
  }
}

// создадим маршрутный узел, в котором при инициации будет объявлена модель данных `Customers`
// и подключим в нее ранее объявленные точки назначения по указанному пути и методам
@Use(Customers.Init)
@Get("/", Data.List)
@Post("/", Data.Add)
class Customers {
  model = models.Customers;

  @Middleware()
  static Init(@State() state, @This() { model }: Users, @Next() next) {
    Object.assign(state, { model });
    return next();
  }
}
```

В качестве второго аргумента для декораторов `Get`/`Post`/`Put`/`Patch`/`Options`/`Delete`/`All` могут
использоваться только те методы, которые были инициированы как "общие" декораторы. В противном случае
при сборке будет вызвана ошибка.

**Важно!** Контекстом "общих" точек назначения является класс, в котором они объявлены: то есть в
декораторе `@This` по умолчанию будет использован собственный класс (в указанном примере `Data`),
а в возвращаемом значении декоратора `@Route()` при разных вызовах будет отличаться только
значения `path` и `method`.
